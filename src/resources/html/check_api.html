<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API ì—°ê²° í™•ì¸</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .check-item {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #ddd;
        }
        .check-item.success {
            border-left-color: #4CAF50;
        }
        .check-item.error {
            border-left-color: #F44336;
        }
        .check-item.pending {
            border-left-color: #FF9800;
        }
        button {
            background: #FF8126;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #E65100;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .status {
            font-weight: bold;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>ğŸ” API ì—°ê²° í™•ì¸ ë„êµ¬</h1>
    
    <div class="check-item pending" id="check1">
        <div class="status">1. API ëª¨ë“ˆ ë¡œë“œ í™•ì¸</div>
        <div id="check1-result">í™•ì¸ ì¤‘...</div>
    </div>
    
    <div class="check-item pending" id="check2">
        <div class="status">2. ì„œë²„ ì—°ê²° í™•ì¸ (í…ŒìŠ¤íŠ¸ ì—”ë“œí¬ì¸íŠ¸)</div>
        <button onclick="testConnection()">ì—°ê²° í…ŒìŠ¤íŠ¸</button>
        <div id="check2-result">ëŒ€ê¸° ì¤‘...</div>
    </div>
    
    <div class="check-item pending" id="check3">
        <div class="status">3. ìì¹˜êµ¬ í†µê³„ API í™•ì¸</div>
        <button onclick="testDistrictStats()">í†µê³„ API í…ŒìŠ¤íŠ¸</button>
        <div id="check3-result">ëŒ€ê¸° ì¤‘...</div>
    </div>
    
    <div class="check-item">
        <div class="status">4. í˜„ì¬ ì„¤ì •</div>
        <pre id="config-info"></pre>
    </div>

    <script src="api.js"></script>
    <script>
        // 1. API ëª¨ë“ˆ ë¡œë“œ í™•ì¸
        function checkApiModule() {
            const check1 = document.getElementById('check1');
            const check1Result = document.getElementById('check1-result');
            
            if (typeof api !== 'undefined') {
                check1.className = 'check-item success';
                check1Result.innerHTML = 'âœ… API ëª¨ë“ˆì´ ì •ìƒì ìœ¼ë¡œ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.<br>' +
                    '- api.getDistrictStats: ' + (typeof api.getDistrictStats) + '<br>' +
                    '- api.apiCall: ' + (typeof api.apiCall);
            } else {
                check1.className = 'check-item error';
                check1Result.innerHTML = 'âŒ API ëª¨ë“ˆì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br>' +
                    'api.js íŒŒì¼ì´ ì œëŒ€ë¡œ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.';
            }
        }
        
        // 2. ì„œë²„ ì—°ê²° í…ŒìŠ¤íŠ¸
        async function testConnection() {
            const check2 = document.getElementById('check2');
            const check2Result = document.getElementById('check2-result');
            
            check2.className = 'check-item pending';
            check2Result.innerHTML = 'í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            try {
                // í˜„ì¬ ì„œë²„ ì£¼ì†Œë¡œ í…ŒìŠ¤íŠ¸ (ë™ì )
                const testUrl = `${window.location.origin}/admin/test`;
                console.log('í…ŒìŠ¤íŠ¸ URL:', testUrl);
                const response = await fetch(testUrl);
                const data = await response.json();
                
                if (response.ok) {
                    check2.className = 'check-item success';
                    check2Result.innerHTML = 'âœ… ì„œë²„ ì—°ê²° ì„±ê³µ!<br><pre>' + 
                        JSON.stringify(data, null, 2) + '</pre>';
                } else {
                    check2.className = 'check-item error';
                    check2Result.innerHTML = 'âŒ ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜: ' + response.status + ' ' + response.statusText;
                }
            } catch (error) {
                check2.className = 'check-item error';
                check2Result.innerHTML = 'âŒ ì—°ê²° ì‹¤íŒ¨: ' + error.message + '<br>' +
                    'ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€, ì£¼ì†Œê°€ ë§ëŠ”ì§€ í™•ì¸í•˜ì„¸ìš”.';
            }
        }
        
        // 3. ìì¹˜êµ¬ í†µê³„ API í…ŒìŠ¤íŠ¸
        async function testDistrictStats() {
            const check3 = document.getElementById('check3');
            const check3Result = document.getElementById('check3-result');
            
            check3.className = 'check-item pending';
            check3Result.innerHTML = 'í…ŒìŠ¤íŠ¸ ì¤‘...';
            
            if (typeof api === 'undefined' || !api.getDistrictStats) {
                check3.className = 'check-item error';
                check3Result.innerHTML = 'âŒ API ëª¨ë“ˆì„ ë¨¼ì € ë¡œë“œí•´ì•¼ í•©ë‹ˆë‹¤.';
                return;
            }
            
            try {
                const data = await api.getDistrictStats();
                
                if (data && Array.isArray(data) && data.length > 0) {
                    check3.className = 'check-item success';
                    check3Result.innerHTML = 'âœ… ë°ì´í„° ë¡œë“œ ì„±ê³µ!<br>' +
                        'ë°ì´í„° ê°œìˆ˜: ' + data.length + 'ê°œ êµ¬<br>' +
                        '<pre>' + JSON.stringify(data.slice(0, 3), null, 2) + '...</pre>';
                } else {
                    check3.className = 'check-item error';
                    check3Result.innerHTML = 'âš ï¸ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŠµë‹ˆë‹¤.<br>' +
                        'ì„œë²„ì— ë°ì´í„°ê°€ ì—†ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.';
                }
            } catch (error) {
                check3.className = 'check-item error';
                check3Result.innerHTML = 'âŒ API í˜¸ì¶œ ì‹¤íŒ¨: ' + error.message;
            }
        }
        
        // 4. í˜„ì¬ ì„¤ì • í‘œì‹œ
        function showConfig() {
            const configInfo = document.getElementById('config-info');
            configInfo.textContent = `API_BASE_URL: ${window.location.origin} (ìë™ ê°ì§€)
í˜„ì¬ í˜ì´ì§€ URL: ${window.location.href}
í”„ë¡œí† ì½œ: ${window.location.protocol}
í˜¸ìŠ¤íŠ¸: ${window.location.host}

âœ… ì¥ì :
- ì„œë²„ê°€ ì–´ë””ì„œ ì‹¤í–‰ë˜ë“  ìë™ ì‘ë™
- ë¡œì»¬, EC2, ë‹¤ë¥¸ ì»´í“¨í„° ëª¨ë‘ ì§€ì›
- IP ì£¼ì†Œ ë³€ê²½ ì‹œ ì½”ë“œ ìˆ˜ì • ë¶ˆí•„ìš”

âš ï¸ ì„œë²„ í™•ì¸ ì‚¬í•­:
1. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ê°€ìš”? (python -m src.main)
2. ì„œë²„ê°€ 8000 í¬íŠ¸ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ê°€ìš”?
3. ë°©í™”ë²½ì—ì„œ 8000 í¬íŠ¸ê°€ ì—´ë ¤ìˆë‚˜ìš”?`;
        }
        
        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì‹¤í–‰
        window.addEventListener('DOMContentLoaded', () => {
            checkApiModule();
            showConfig();
        });
    </script>
</body>
</html>

