<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 대시보드</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="layout">
        <aside class="sidebar">
            <div class="sidebar__brand">오늘 뭐하지?</div>
            <nav class="sidebar__nav" aria-label="사이드바">
                <a class="sidebar__tab is-active" href="dashboard.html">통계 관리</a>
                <a class="sidebar__tab" href="data.html">데이터 관리</a>
                <a class="sidebar__tab" href="users.html">사용자 관리</a>
            </nav>
        </aside>
        <div class="content">
            <header id="overview">
                <h1>오늘 뭐하지? 관리자 대시보드</h1>
            </header> 

            <div class="summary">
                <article class="summary-card">
                    <h2>총 사용자 수</h2>
                    <p class="summary-card__value">12,345</p>
                </article>
                <article class="summary-card summary-card--chart">
                    <h2>일정표 생성 수</h2>
                    <p class="summary-card__value">482</p>
                    <div class="summary-card__chart">
                        <canvas id="recommendationBar" aria-label="추천 생성 추이"></canvas>
                    </div>
                </article>
                <article class="summary-card summary-card--chart">
                    <h2>요일별 평균 일정표 생성 수</h2>
                    <p class="summary-card__value">68.9</p>
                    <div class="summary-card__chart">
                        <canvas id="weeklyAverageBar" aria-label="요일별 평균 일정표 생성 수"></canvas>
                    </div>
                </article>
                <article class="summary-card">
                    <h2>인기 카테고리 (일정표 생성 기준)</h2>
                    <div class="chart-container">
                        <canvas id="categoryPie" aria-label="인기 카테고리 비율"></canvas>
                    </div>
                    <ul class="chart-legend">
                        <li><span class="swatch" style="background-color: #FF6F00;"></span>음식점 · 55%</li>
                        <li><span class="swatch" style="background-color: #FF9800;"></span>카페 · 30%</li>
                        <li><span class="swatch" style="background-color: #FFB74D;"></span>콘텐츠 · 15%</li>
                    </ul>
                </article>
            </div>

            <main>
                <section id="region" class="card">
                    <h2>일정표 생성 기준 인기 지역</h2>
                    <div class="chart-container chart-container--wide">
                        <canvas id="regionBar" aria-label="지역별 비율 막대차트" style="height: 400px;"></canvas>
                    </div>
                </section>
                <section id="templates" class="card">
                    <h2>일정 템플릿 관리</h2>
                    <div class="chart-row">
                        <div class="chart-row__media">
                            <canvas id="templatePie" aria-label="일정 템플릿 선택 비율"></canvas>
                        </div>
                        <div class="chart-row__legend">
                            <div class="chart-row__legend-item">
                                <span class="chart-row__swatch" style="background-color: #FF6F00;"></span>
                                일정표 1 · 52%
                            </div>
                            <div class="chart-row__legend-item">
                                <span class="chart-row__swatch" style="background-color: #FF9800;"></span>
                                일정표 2 · 31%
                            </div>
                            <div class="chart-row__legend-item">
                                <span class="chart-row__swatch" style="background-color: #FFB74D;"></span>
                                일정표 3 · 17%
                            </div>
                        </div>
                    </div>
                </section>

                <section id="mobility" class="card">
                    <h2>이동수단 관리</h2>
                    <div class="chart-row">
                        <div class="chart-row__media">
                            <canvas id="mobilityPie" aria-label="이동수단 선택 비율"></canvas>
                        </div>
                        <div class="chart-row__legend">
                            <div class="chart-row__legend-item">
                                <span class="chart-row__swatch" style="background-color: #FF6F00;"></span>
                                도보 · 40%
                            </div>
                            <div class="chart-row__legend-item">
                                <span class="chart-row__swatch" style="background-color: #FF9800;"></span>
                                대중교통 · 35%
                            </div>
                            <div class="chart-row__legend-item">
                                <span class="chart-row__swatch" style="background-color: #FFB74D;"></span>
                                자동차 · 25%
                            </div>
                        </div>
                    </div>
                </section>

                <section id="travel" class="card">
                    <h2>평균 이동 시간</h2>
                    <p class="section-subtitle">최근 30일 기준 이동 경로 분석</p>
                    <div class="chart-row">
                        <div class="chart-row__media chart-row__media--wide">
                            <canvas id="travelTimeLine" aria-label="평균 이동 시간 추이"></canvas>
                        </div>
                        <div class="chart-row__legend">
                            <div class="chart-row__legend-item">
                                <span class="chart-row__swatch" style="background-color: #FF8126;"></span>
                                일별 평균 이동 시간 (분)
                            </div>
                            <div class="chart-row__legend-item">
                                <span class="chart-row__swatch" style="background-color: #FFA726;"></span>
                                주간 평균 대비 증감
                            </div>
                        </div>
                    </div>
                    <div class="stat-grid">
                        <div class="stat-card">
                            <strong>42분</strong>
                            <span>전체 이동 평균</span>
                        </div>
                        <div class="stat-card">
                            <strong>3분</strong>
                            <span>도보 평균 이동 시간</span>
                        </div>
                        <div class="stat-card">
                            <strong>28분</strong>
                            <span>대중교통 평균 이동 시간</span>
                        </div>
                        <div class="stat-card">
                            <strong>58분</strong>
                            <span>자동차 평균 이동 시간</span>
                        </div>
                    </div>
                </section>
            </main>
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
            <script>
                const palette = ['#FF8126', '#FFA726', '#E65100'];

                if (window.ChartDataLabels) {
                    Chart.register(window.ChartDataLabels);
                }

                function createPieChart(canvasId, labels, data, colors, formatter) {
                    const canvas = document.getElementById(canvasId);

                    if (!canvas) {
                        return;
                    }

                    const baseData = data.map(() => 0);
                    const chart = new Chart(canvas, {
                        type: 'pie',
                        data: {
                            labels,
                            datasets: [{
                                data: baseData,
                                backgroundColor: colors,
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            animation: {
                                animateRotate: true,
                                animateScale: true,
                                duration: 1200,
                                easing: 'easeOutQuart'
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                datalabels: {
                                    formatter,
                                    color: '#ffffff',
                                    font: {
                                        weight: 'bold',
                                        size: 14
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label(context) {
                                            const label = context.label || '';
                                            const value = context.parsed;
                                            const total = context.dataset.data.reduce((acc, curr) => acc + curr, 0);
                                            const percent = ((value / total) * 100).toFixed(1);
                                            return `${label}: ${value} (${percent}%)`;
                                        }
                                    }
                                }
                            }
                        }
                    });

                    setTimeout(() => {
                        chart.data.datasets[0].data = data;
                        chart.update();
                    }, 100);

                    return chart;
                }

                function createSparkBarChart(canvasId, labels, data) {
                    const canvas = document.getElementById(canvasId);

                    if (!canvas) {
                        return;
                    }

                    const baseData = data.map(() => 0);
                    const chart = new Chart(canvas, {
                        type: 'bar',
                        data: {
                            labels,
                            datasets: [{
                                data: baseData,
                                backgroundColor: '#FF8126',
                                borderRadius: 6,
                                categoryPercentage: 0.5,
                                barPercentage: 0.8,
                                maxBarThickness: 18
                            }]
                        },
                        options: {
                            maintainAspectRatio: false,
                            layout: {
                                padding: {
                                    top: 8,
                                    bottom: 8
                                }
                            },
                            animation: {
                                duration: 800,
                                easing: 'easeOutQuart'
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                datalabels: {
                                    display: false
                                },
                                tooltip: {
                                    callbacks: {
                                        label(context) {
                                            return `${context.parsed.y}건`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    display: true,
                                    ticks: {
                                        color: '#52606d',
                                        maxRotation: 0,
                                        autoSkip: true,
                                        font: {
                                            size: 11
                                        }
                                    },
                                    grid: {
                                        display: false
                                    }
                                },
                                y: {
                                    display: true,
                                    beginAtZero: true,
                                    ticks: {
                                        color: '#52606d',
                                        stepSize: 100,
                                        callback: (value) => `${value}건`,
                                        font: {
                                            size: 11
                                        }
                                    },
                                    grid: {
                                        color: 'rgba(82, 96, 109, 0.12)',
                                        drawBorder: false
                                    }
                                }
                            }
                        }
                    });

                    setTimeout(() => {
                        chart.data.datasets[0].data = data;
                        chart.update();
                    }, 100);

                    return chart;
                }

                createPieChart(
                    'categoryPie',
                    ['음식점', '카페', '콘텐츠'],
                    [55, 30, 15],
                    ['#FF6F00', '#FF9800', '#FFB74D'],
                    (value) => `${value}`
                );

                createSparkBarChart(
                    'recommendationBar',
                    ['5일 전', '4일 전', '3일 전', '2일 전', '어제', '오늘'],
                    [360, 410, 395, 430, 470, 482]
                );

                createSparkBarChart(
                    'weeklyAverageBar',
                    ['월', '화', '수', '목', '금', '토', '일'],
                    [52, 58, 61, 65, 72, 85, 78]
                );
                
                // 요일별 평균 일정표 생성 수 차트의 y축을 10 단위로 설정
                setTimeout(() => {
                    const weeklyChart = Chart.getChart('weeklyAverageBar');
                    if (weeklyChart) {
                        weeklyChart.options.scales.y.ticks.stepSize = 10;
                        weeklyChart.update();
                    }
                }, 200);

                createPieChart(
                    'templatePie',
                    ['일정표 1', '일정표 2', '일정표 3'],
                    [52, 31, 17],
                    ['#FF6F00', '#FF9800', '#FFB74D'],
                    (value) => `${value}`
                );

                createPieChart(
                    'mobilityPie',
                    ['도보', '대중교통', '자동차'],
                    [40, 35, 25],
                    ['#FF6F00', '#FF9800', '#FFB74D'],
                    (value) => `${value}`
                );

                const travelTimeEl = document.getElementById('travelTimeLine');

                if (travelTimeEl) {
                    const travelData = [48, 45, 43, 44, 41, 39];
                    const travelChart = new Chart(travelTimeEl, {
                        type: 'line',
                        data: {
                            labels: ['5일 전', '4일 전', '3일 전', '2일 전', '어제', '오늘'],
                            datasets: [{
                                label: '평균 이동 시간',
                                data: travelData.map(() => 0),
                                borderColor: '#FF8126',
                                backgroundColor: 'rgba(255, 129, 38, 0.18)',
                                tension: 0.35,
                                fill: true,
                                pointRadius: 4,
                                pointBackgroundColor: '#FF8126',
                                pointHoverRadius: 5
                            }]
                        },
                        options: {
                            maintainAspectRatio: false,
                            scales: {
                                x: {
                                    ticks: {
                                        color: '#52606d'
                                    },
                                    grid: {
                                        color: 'rgba(82, 96, 109, 0.08)'
                                    }
                                },
                                y: {
                                    beginAtZero: false,
                                    ticks: {
                                        color: '#52606d',
                                        callback: (value) => `${value}분`
                                    },
                                    grid: {
                                        color: 'rgba(82, 96, 109, 0.12)'
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    callbacks: {
                                        label(context) {
                                            return `${context.parsed.y}분`;
                                        }
                                    }
                                }
                            }
                        }
                    });

                    setTimeout(() => {
                        travelChart.data.datasets[0].data = travelData;
                        travelChart.update();
                    }, 120);
                }

                const regionBarEl = document.getElementById('regionBar');

                if (regionBarEl) {
                    const regionStats = [
                        { label: '강남구', value: 142 },
                        { label: '강동구', value: 58 },
                        { label: '강서구', value: 76 },
                        { label: '강북구', value: 45 },
                        { label: '관악구', value: 63 },
                        { label: '광진구', value: 48 },
                        { label: '구로구', value: 52 },
                        { label: '금천구', value: 28 },
                        { label: '노원구', value: 67 },
                        { label: '도봉구', value: 32 },
                        { label: '동대문구', value: 54 },
                        { label: '동작구', value: 61 },
                        { label: '마포구', value: 70 },
                        { label: '서대문구', value: 46 },
                        { label: '성동구', value: 59 },
                        { label: '성북구', value: 57 },
                        { label: '서초구', value: 88 },
                        { label: '송파구', value: 95 },
                        { label: '양천구', value: 50 },
                        { label: '영등포구', value: 72 },
                        { label: '용산구', value: 64 },
                        { label: '은평구', value: 41 },
                        { label: '종로구', value: 37 },
                        { label: '중구', value: 44 },
                        { label: '중랑구', value: 49 }
                    ];

                    const regionLabels = regionStats.map(({ label }) => label);
                    const regionValues = regionStats.map(({ value }) => value);
                    const totalRegionValue = regionValues.reduce((acc, curr) => acc + curr, 0);

                    const baseRegionValues = regionValues.map(() => 0);

                    const regionChart = new Chart(regionBarEl, {
                        type: 'bar',
                        data: {
                            labels: regionLabels,
                            datasets: [{
                                data: baseRegionValues,
                                backgroundColor: '#FF8126',
                                hoverBackgroundColor: '#E65100',
                                borderRadius: 6,
                                maxBarThickness: 18
                            }]
                        },
                        options: {
                            maintainAspectRatio: false,
                            scales: {
                                x: {
                                    beginAtZero: true,
                                    ticks: {
                                        color: '#52606d',
                                        maxRotation: 45,
                                        minRotation: 45,
                                        autoSkip: false
                                    },
                                    grid: {
                                        display: false
                                    }
                                },
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        color: '#52606d',
                                        callback: (value) => `${value}건`
                                    },
                                    grid: {
                                        color: 'rgba(82, 96, 109, 0.12)',
                                        drawBorder: false
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                datalabels: {
                                    display: false
                                },
                                tooltip: {
                                    callbacks: {
                                        label(context) {
                                            const value = context.parsed.x;
                                            const percent = ((value / totalRegionValue) * 100).toFixed(1);
                                            return `${context.label}: ${value}건 (${percent}%)`;
                                        }
                                    }
                                }
                            }
                        }
                    });

                    setTimeout(() => {
                        regionChart.data.datasets[0].data = regionValues;
                        regionChart.update();
                    }, 150);
                }

            </script>
        </div>
    </div>
</body>
</html>

