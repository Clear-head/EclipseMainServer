<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>관리자 대시보드</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="layout">
        <aside class="sidebar">
            <div class="sidebar__brand">오늘 뭐하지?</div>
            <nav class="sidebar__nav" aria-label="사이드바">
                <a class="sidebar__tab is-active" href="dashboard.html">통계 관리</a>
                <a class="sidebar__tab" href="data.html">데이터 관리</a>
                <a class="sidebar__tab" href="users.html">사용자 관리</a>
            </nav>
        </aside>
        <div class="content">
            <header id="overview">
                <h1>오늘 뭐하지? 관리자 대시보드</h1>
            </header> 

            <div class="summary">
                <article class="summary-card">
                    <h2>총 사용자 수</h2>
                    <p class="summary-card__value" id="totalUsers">-</p>
                </article>
                <article class="summary-card summary-card--chart">
                    <h2>일정표 생성 수</h2>
                    <p class="summary-card__value" id="recommendationTotal">-</p>
                    <div class="summary-card__chart">
                        <canvas id="recommendationBar" aria-label="추천 생성 추이"></canvas>
                    </div>
                </article>
                <article class="summary-card summary-card--chart">
                    <h2>요일별 평균 일정표 생성 수</h2>
                    <p class="summary-card__value" id="weeklyAverageTotal">-</p>
                    <div class="summary-card__chart">
                        <canvas id="weeklyAverageBar" aria-label="요일별 평균 일정표 생성 수"></canvas>
                    </div>
                </article>
                <article class="summary-card">
                    <h2>인기 카테고리 (일정표 생성 기준)</h2>
                    <div class="chart-container">
                        <canvas id="categoryPie" aria-label="인기 카테고리 비율"></canvas>
                    </div>
                    <ul class="chart-legend" id="categoryLegend">
                        <li><span class="swatch" style="background-color: #FF6F00;"></span>음식점 · -</li>
                        <li><span class="swatch" style="background-color: #FF9800;"></span>카페 · -</li>
                        <li><span class="swatch" style="background-color: #FFB74D;"></span>콘텐츠 · -</li>
                    </ul>
                </article>
            </div>

            <main>
                <section id="region" class="card">
                    <h2>일정표 생성 기준 인기 지역</h2>
                    <div class="chart-container chart-container--wide">
                        <canvas id="regionBar" aria-label="지역별 비율 막대차트" style="height: 400px;"></canvas>
                    </div>
                </section>
                <section id="templates" class="card">
                    <h2>일정 템플릿 관리</h2>
                    <div class="chart-row">
                        <div class="chart-row__media">
                            <canvas id="templatePie" aria-label="일정 템플릿 선택 비율"></canvas>
                        </div>
                        <div class="chart-row__legend" id="templateLegend">
                            <div class="chart-row__legend-item">
                                <span class="chart-row__swatch" style="background-color: #FF6F00;"></span>
                                일반 일정표 · -
                            </div>
                            <div class="chart-row__legend-item">
                                <span class="chart-row__swatch" style="background-color: #FF9800;"></span>
                                템플릿 1 · -
                            </div>
                            <div class="chart-row__legend-item">
                                <span class="chart-row__swatch" style="background-color: #FFB74D;"></span>
                                템플릿 2 · -
                            </div>
                            <div class="chart-row__legend-item">
                                <span class="chart-row__swatch" style="background-color: #FFCC80;"></span>
                                템플릿 3 · -
                            </div>
                        </div>
                    </div>
                </section>

                <section id="mobility" class="card">
                    <h2>이동수단 관리</h2>
                    <div class="chart-row">
                        <div class="chart-row__media">
                            <canvas id="mobilityPie" aria-label="이동수단 선택 비율"></canvas>
                        </div>
                        <div class="chart-row__legend" id="mobilityLegend">
                            <div class="chart-row__legend-item">
                                <span class="chart-row__swatch" style="background-color: #FF6F00;"></span>
                                도보 · -
                            </div>
                            <div class="chart-row__legend-item">
                                <span class="chart-row__swatch" style="background-color: #FF9800;"></span>
                                대중교통 · -
                            </div>
                            <div class="chart-row__legend-item">
                                <span class="chart-row__swatch" style="background-color: #FFB74D;"></span>
                                자동차 · -
                            </div>
                        </div>
                    </div>
                </section>

                <section id="travel" class="card">
                    <h2>평균 이동 시간</h2>
                    <p class="section-subtitle">최근 30일 기준 이동 경로 분석</p>
                    <div class="chart-row">
                        <div class="chart-row__media chart-row__media--wide">
                            <canvas id="travelTimeLine" aria-label="평균 이동 시간 추이"></canvas>
                        </div>
                        <div class="chart-row__legend">
                            <div class="chart-row__legend-item">
                                <span class="chart-row__swatch" style="background-color: #FF8126;"></span>
                                일별 평균 이동 시간 (분)
                            </div>
                            <div class="chart-row__legend-item">
                                <span class="chart-row__swatch" style="background-color: #FFA726;"></span>
                                주간 평균 대비 증감
                            </div>
                        </div>
                    </div>
                    <div class="stat-grid">
                        <div class="stat-card">
                            <strong>42분</strong>
                            <span>전체 이동 평균</span>
                        </div>
                        <div class="stat-card">
                            <strong>3분</strong>
                            <span>도보 평균 이동 시간</span>
                        </div>
                        <div class="stat-card">
                            <strong>28분</strong>
                            <span>대중교통 평균 이동 시간</span>
                        </div>
                        <div class="stat-card">
                            <strong>58분</strong>
                            <span>자동차 평균 이동 시간</span>
                        </div>
                    </div>
                </section>
            </main>
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2"></script>
            <script>
                const palette = ['#FF8126', '#FFA726', '#E65100'];

                // 총 사용자 수 조회
                async function loadTotalUsers() {
                    try {
                        const response = await fetch('/api/dashboard/total-users');
                        const data = await response.json();
                        const totalUsersEl = document.getElementById('totalUsers');
                        if (totalUsersEl && data.total_users !== undefined) {
                            totalUsersEl.textContent = data.total_users.toLocaleString('ko-KR');
                        }
                    } catch (error) {
                        console.error('총 사용자 수 조회 오류:', error);
                    }
                }

                // 페이지 로드 시 총 사용자 수 조회
                loadTotalUsers();

                // 일정표 생성 수 통계 조회 및 차트 업데이트
                let recommendationChart = null;
                async function loadRecommendationStats() {
                    try {
                        const response = await fetch('/api/dashboard/recommendation-stats');
                        const data = await response.json();
                        
                        // 최근 6일치 데이터 준비 (5일 전부터 오늘까지)
                        const today = new Date();
                        const labels = ['5일 전', '4일 전', '3일 전', '2일 전', '어제', '오늘'];
                        const chartData = [0, 0, 0, 0, 0, 0];
                        
                        // API 데이터를 맵으로 변환 (날짜를 키로)
                        const dataMap = {};
                        data.forEach(item => {
                            dataMap[item.visited_date] = item.count;
                        });
                        
                        // 각 날짜에 해당하는 데이터 채우기
                        for (let i = 0; i < 6; i++) {
                            const date = new Date(today);
                            date.setDate(date.getDate() - (5 - i));
                            const dateStr = date.toISOString().split('T')[0];
                            if (dataMap[dateStr] !== undefined) {
                                chartData[i] = dataMap[dateStr];
                            }
                        }
                        
                        // 총 일정표 생성 수 업데이트 (오늘 값 또는 최근 값)
                        const recommendationTotalEl = document.getElementById('recommendationTotal');
                        if (recommendationTotalEl) {
                            const total = chartData[5] || chartData[chartData.length - 1] || 0;
                            recommendationTotalEl.textContent = total.toLocaleString('ko-KR');
                        }
                        
                        // 차트 업데이트
                        if (recommendationChart) {
                            recommendationChart.data.datasets[0].data = chartData;
                            recommendationChart.update();
                        } else {
                            // 차트가 없으면 생성
                            recommendationChart = createSparkBarChart(
                                'recommendationBar',
                                labels,
                                chartData
                            );
                        }
                    } catch (error) {
                        console.error('일정표 생성 수 통계 조회 오류:', error);
                    }
                }

                // 요일별 평균 일정표 생성 수 통계 조회 및 차트 업데이트
                let weeklyAverageChart = null;
                async function loadWeeklyAverageStats() {
                    try {
                        const response = await fetch('/api/dashboard/weekly-average-stats');
                        const data = await response.json();
                        
                        // 요일 순서: 월, 화, 수, 목, 금, 토, 일
                        const weekdayOrder = ['월', '화', '수', '목', '금', '토', '일'];
                        const chartData = [0, 0, 0, 0, 0, 0, 0];
                        
                        // API 데이터를 맵으로 변환 (요일을 키로)
                        const dataMap = {};
                        data.forEach(item => {
                            dataMap[item.weekday_kor] = item.avg_per_week;
                        });
                        
                        // 요일 순서에 맞게 데이터 채우기
                        weekdayOrder.forEach((weekday, index) => {
                            if (dataMap[weekday] !== undefined) {
                                chartData[index] = dataMap[weekday];
                            }
                        });
                        
                        // 전체 평균 계산 및 표시
                        const weeklyAverageTotalEl = document.getElementById('weeklyAverageTotal');
                        if (weeklyAverageTotalEl) {
                            const total = chartData.reduce((sum, val) => sum + val, 0);
                            const average = total > 0 ? (total / chartData.filter(v => v > 0).length).toFixed(1) : 0;
                            // 평균값과 총합을 함께 표시
                            weeklyAverageTotalEl.innerHTML = `${average} <span style="color: #9ca3af; font-size: 0.5em; font-weight: normal;">(총 ${total.toLocaleString('ko-KR')}건)</span>`;
                        }
                        
                        // 차트 업데이트
                        if (weeklyAverageChart) {
                            weeklyAverageChart.data.datasets[0].data = chartData;
                            weeklyAverageChart.update();
                        } else {
                            // 차트가 없으면 생성
                            weeklyAverageChart = createSparkBarChart(
                                'weeklyAverageBar',
                                weekdayOrder,
                                chartData
                            );
                        }
                    } catch (error) {
                        console.error('요일별 평균 일정표 생성 수 통계 조회 오류:', error);
                    }
                }

                // 인기 카테고리 통계 조회 및 차트 업데이트
                let categoryPieChart = null;
                async function loadPopularCategories() {
                    try {
                        const response = await fetch('/api/dashboard/popular-categories');
                        const data = await response.json();
                        
                        // 카테고리 타입 매핑: '0' -> 음식점, '1' -> 카페, '2' -> 콘텐츠
                        const categoryMap = {
                            '0': { name: '음식점', color: '#FF6F00' },
                            '1': { name: '카페', color: '#FF9800' },
                            '2': { name: '콘텐츠', color: '#FFB74D' }
                        };
                        
                        // 데이터 정렬 (total_count 기준 내림차순)
                        const sortedData = data.sort((a, b) => b.total_count - a.total_count);
                        
                        const labels = [];
                        const chartData = [];
                        const colors = [];
                        
                        sortedData.forEach(item => {
                            const category = categoryMap[item.category_type];
                            if (category) {
                                labels.push(category.name);
                                chartData.push(item.total_count);
                                colors.push(category.color);
                            }
                        });
                        
                        // 범례 업데이트
                        const legendEl = document.getElementById('categoryLegend');
                        if (legendEl) {
                            legendEl.innerHTML = sortedData.map(item => {
                                const category = categoryMap[item.category_type];
                                if (category) {
                                    return `<li><span class="swatch" style="background-color: ${category.color};"></span>${category.name} · ${item.percentage}%</li>`;
                                }
                                return '';
                            }).join('');
                        }
                        
                        // 차트 업데이트
                        if (categoryPieChart) {
                            categoryPieChart.data.labels = labels;
                            categoryPieChart.data.datasets[0].data = chartData;
                            categoryPieChart.data.datasets[0].backgroundColor = colors;
                            categoryPieChart.update();
                        } else {
                            // 차트가 없으면 생성
                            categoryPieChart = createPieChart(
                                'categoryPie',
                                labels,
                                chartData,
                                colors,
                                (value) => `${value}`
                            );
                        }
                    } catch (error) {
                        console.error('인기 카테고리 통계 조회 오류:', error);
                    }
                }

                // 일정표 생성 기준 인기 지역 통계 조회 및 차트 업데이트
                let regionChart = null;
                async function loadPopularDistricts() {
                    try {
                        const response = await fetch('/api/dashboard/popular-districts');
                        const data = await response.json();
                        
                        const regionLabels = data.map(item => item.district);
                        const regionValues = data.map(item => item.total_count);
                        const totalRegionValue = regionValues.reduce((acc, curr) => acc + curr, 0);
                        
                        // 차트 업데이트
                        if (regionChart) {
                            regionChart.data.labels = regionLabels;
                            regionChart.data.datasets[0].data = regionValues;
                            // tooltip 콜백 업데이트를 위해 totalRegionValue 저장
                            regionChart.options.plugins.tooltip.callbacks.label = (context) => {
                                const value = context.parsed.y;
                                const percent = totalRegionValue > 0 ? ((value / totalRegionValue) * 100).toFixed(1) : 0;
                                return `${context.label}: ${value}건 (${percent}%)`;
                            };
                            regionChart.update();
                        } else {
                            // 차트가 없으면 생성
                            const baseRegionValues = regionValues.map(() => 0);
                            const regionBarEl = document.getElementById('regionBar');
                            
                            if (regionBarEl) {
                                regionChart = new Chart(regionBarEl, {
                                    type: 'bar',
                                    data: {
                                        labels: regionLabels,
                                        datasets: [{
                                            data: baseRegionValues,
                                            backgroundColor: '#FF8126',
                                            hoverBackgroundColor: '#E65100',
                                            borderRadius: 6,
                                            maxBarThickness: 18
                                        }]
                                    },
                                    options: {
                                        maintainAspectRatio: false,
                                        scales: {
                                            x: {
                                                beginAtZero: true,
                                                ticks: {
                                                    color: '#52606d',
                                                    maxRotation: 45,
                                                    minRotation: 45,
                                                    autoSkip: false
                                                },
                                                grid: {
                                                    display: false
                                                }
                                            },
                                            y: {
                                                beginAtZero: true,
                                                ticks: {
                                                    color: '#52606d',
                                                    callback: (value) => `${value}건`
                                                },
                                                grid: {
                                                    color: 'rgba(82, 96, 109, 0.12)',
                                                    drawBorder: false
                                                }
                                            }
                                        },
                                        plugins: {
                                            legend: {
                                                display: false
                                            },
                                            datalabels: {
                                                display: false
                                            },
                                            tooltip: {
                                                callbacks: {
                                                    label(context) {
                                                        const value = context.parsed.y;
                                                        const percent = totalRegionValue > 0 ? ((value / totalRegionValue) * 100).toFixed(1) : 0;
                                                        return `${context.label}: ${value}건 (${percent}%)`;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                });
                                
                                setTimeout(() => {
                                    regionChart.data.datasets[0].data = regionValues;
                                    regionChart.update();
                                }, 150);
                            }
                        }
                    } catch (error) {
                        console.error('인기 지역 통계 조회 오류:', error);
                    }
                }

                // 일정 템플릿 통계 조회 및 차트 업데이트
                let templatePieChart = null;
                async function loadTemplateStats() {
                    try {
                        const response = await fetch('/api/dashboard/template-stats');
                        const data = await response.json();
                        
                        // 템플릿 타입별 워딩 매핑
                        const templateNameMap = {
                            '0': '일반 일정표',
                            '1': '템플릿 1',
                            '2': '템플릿 2',
                            '3': '템플릿 3'
                        };
                        
                        // 템플릿 타입별 색상 (4개까지 지원)
                        const colors = ['#FF6F00', '#FF9800', '#FFB74D', '#FFCC80'];
                        
                        // 데이터 정렬 (template_type 기준 오름차순)
                        const sortedData = data.sort((a, b) => {
                            const aNum = parseInt(a.template_type) || 0;
                            const bNum = parseInt(b.template_type) || 0;
                            return aNum - bNum;
                        });
                        
                        const labels = sortedData.map(item => {
                            const name = templateNameMap[item.template_type];
                            return name || `템플릿 ${item.template_type}`;
                        });
                        const chartData = sortedData.map(item => item.total_count);
                        const chartColors = sortedData.map((item, index) => {
                            // template_type에 따라 색상 할당 (0, 1, 2, 3 순서)
                            const typeNum = parseInt(item.template_type) || 0;
                            return colors[typeNum] || colors[index % colors.length];
                        });
                        
                        // 범례 업데이트
                        const legendEl = document.getElementById('templateLegend');
                        if (legendEl) {
                            legendEl.innerHTML = sortedData.map((item, index) => {
                                const name = templateNameMap[item.template_type] || `템플릿 ${item.template_type}`;
                                return `<div class="chart-row__legend-item">
                                    <span class="chart-row__swatch" style="background-color: ${chartColors[index]};"></span>
                                    ${name} · ${item.percentage}%
                                </div>`;
                            }).join('');
                        }
                        
                        // 차트 업데이트
                        if (templatePieChart) {
                            templatePieChart.data.labels = labels;
                            templatePieChart.data.datasets[0].data = chartData;
                            templatePieChart.data.datasets[0].backgroundColor = chartColors;
                            templatePieChart.update();
                        } else {
                            // 차트가 없으면 생성
                            templatePieChart = createPieChart(
                                'templatePie',
                                labels,
                                chartData,
                                chartColors,
                                (value) => `${value}`
                            );
                        }
                    } catch (error) {
                        console.error('일정 템플릿 통계 조회 오류:', error);
                    }
                }

                // 이동수단 통계 조회 및 차트 업데이트
                let mobilityPieChart = null;
                async function loadTransportationStats() {
                    try {
                        const response = await fetch('/api/dashboard/transportation-stats');
                        const data = await response.json();
                        
                        console.log('이동수단 데이터:', data); // 디버깅용
                        
                        // 이동수단 매핑 및 색상 (데이터베이스 값: '0'=도보, '1'=대중교통, '2'=자동차)
                        const transportationMap = {
                            '0': { name: '도보', color: '#FF6F00' },
                            '1': { name: '대중교통', color: '#FF9800' },
                            '2': { name: '자동차', color: '#FFB74D' },
                            // 혹시 문자열로 저장된 경우도 대비
                            '도보': { name: '도보', color: '#FF6F00' },
                            '대중교통': { name: '대중교통', color: '#FF9800' },
                            '자동차': { name: '자동차', color: '#FFB74D' }
                        };
                        
                        // 데이터 정렬 (transportation 기준: 0, 1, 2 순서)
                        const sortedData = data.sort((a, b) => {
                            const order = ['0', '1', '2', '도보', '대중교통', '자동차'];
                            const aIndex = order.indexOf(a.transportation);
                            const bIndex = order.indexOf(b.transportation);
                            return (aIndex === -1 ? 999 : aIndex) - (bIndex === -1 ? 999 : bIndex);
                        });
                        
                        const labels = sortedData.map(item => {
                            const transport = transportationMap[item.transportation];
                            return transport ? transport.name : item.transportation;
                        });
                        const chartData = sortedData.map(item => item.total_count);
                        const chartColors = sortedData.map(item => {
                            const transport = transportationMap[item.transportation];
                            return transport ? transport.color : '#FF6F00';
                        });
                        
                        console.log('차트 색상:', chartColors); // 디버깅용
                        
                        // 범례 업데이트
                        const legendEl = document.getElementById('mobilityLegend');
                        if (legendEl) {
                            legendEl.innerHTML = sortedData.map(item => {
                                const transport = transportationMap[item.transportation];
                                const name = transport ? transport.name : item.transportation;
                                const color = transport ? transport.color : '#FF6F00';
                                return `<div class="chart-row__legend-item">
                                    <span class="chart-row__swatch" style="background-color: ${color};"></span>
                                    ${name} · ${item.percentage}%
                                </div>`;
                            }).join('');
                        }
                        
                        // 차트 업데이트
                        if (mobilityPieChart) {
                            mobilityPieChart.data.labels = labels;
                            mobilityPieChart.data.datasets[0].data = chartData;
                            mobilityPieChart.data.datasets[0].backgroundColor = chartColors;
                            mobilityPieChart.update();
                        } else {
                            // 차트가 없으면 생성
                            mobilityPieChart = createPieChart(
                                'mobilityPie',
                                labels,
                                chartData,
                                chartColors,
                                (value) => `${value}`
                            );
                        }
                    } catch (error) {
                        console.error('이동수단 통계 조회 오류:', error);
                    }
                }

                if (window.ChartDataLabels) {
                    Chart.register(window.ChartDataLabels);
                }

                function createPieChart(canvasId, labels, data, colors, formatter) {
                    const canvas = document.getElementById(canvasId);

                    if (!canvas) {
                        return;
                    }

                    const baseData = data.map(() => 0);
                    const chart = new Chart(canvas, {
                        type: 'pie',
                        data: {
                            labels,
                            datasets: [{
                                data: baseData,
                                backgroundColor: colors,
                                borderWidth: 0
                            }]
                        },
                        options: {
                            responsive: true,
                            animation: {
                                animateRotate: true,
                                animateScale: true,
                                duration: 1200,
                                easing: 'easeOutQuart'
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                datalabels: {
                                    formatter,
                                    color: '#ffffff',
                                    font: {
                                        weight: 'bold',
                                        size: 14
                                    }
                                },
                                tooltip: {
                                    callbacks: {
                                        label(context) {
                                            const label = context.label || '';
                                            const value = context.parsed;
                                            const total = context.dataset.data.reduce((acc, curr) => acc + curr, 0);
                                            const percent = ((value / total) * 100).toFixed(1);
                                            return `${label}: ${value} (${percent}%)`;
                                        }
                                    }
                                }
                            }
                        }
                    });

                    setTimeout(() => {
                        chart.data.datasets[0].data = data;
                        chart.update();
                    }, 100);

                    return chart;
                }

                function createSparkBarChart(canvasId, labels, data) {
                    const canvas = document.getElementById(canvasId);

                    if (!canvas) {
                        return;
                    }

                    const baseData = data.map(() => 0);
                    const chart = new Chart(canvas, {
                        type: 'bar',
                        data: {
                            labels,
                            datasets: [{
                                data: baseData,
                                backgroundColor: '#FF8126',
                                borderRadius: 6,
                                categoryPercentage: 0.5,
                                barPercentage: 0.8,
                                maxBarThickness: 18
                            }]
                        },
                        options: {
                            maintainAspectRatio: false,
                            layout: {
                                padding: {
                                    top: 8,
                                    bottom: 8
                                }
                            },
                            animation: {
                                duration: 800,
                                easing: 'easeOutQuart'
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                datalabels: {
                                    display: false
                                },
                                tooltip: {
                                    callbacks: {
                                        label(context) {
                                            return `${context.parsed.y}건`;
                                        }
                                    }
                                }
                            },
                            scales: {
                                x: {
                                    display: true,
                                    ticks: {
                                        color: '#52606d',
                                        maxRotation: 0,
                                        autoSkip: true,
                                        font: {
                                            size: 11
                                        }
                                    },
                                    grid: {
                                        display: false
                                    }
                                },
                                y: {
                                    display: true,
                                    beginAtZero: true,
                                    ticks: {
                                        color: '#52606d',
                                        stepSize: 100,
                                        callback: (value) => `${value}건`,
                                        font: {
                                            size: 11
                                        }
                                    },
                                    grid: {
                                        color: 'rgba(82, 96, 109, 0.12)',
                                        drawBorder: false
                                    }
                                }
                            }
                        }
                    });

                    setTimeout(() => {
                        chart.data.datasets[0].data = data;
                        chart.update();
                    }, 100);

                    return chart;
                }

                // categoryPie 차트는 loadPopularCategories()에서 동적으로 생성됨

                // recommendationBar 차트는 loadRecommendationStats()에서 동적으로 생성됨
                // createSparkBarChart 함수가 정의된 후에 호출
                setTimeout(() => {
                    loadRecommendationStats();
                    loadWeeklyAverageStats();
                    loadPopularCategories();
                    loadPopularDistricts();
                    loadTemplateStats();
                    loadTransportationStats();
                }, 100);

                // weeklyAverageBar 차트는 loadWeeklyAverageStats()에서 동적으로 생성됨
                
                // 요일별 평균 일정표 생성 수 차트의 y축을 10 단위로 설정
                setTimeout(() => {
                    const weeklyChart = Chart.getChart('weeklyAverageBar');
                    if (weeklyChart) {
                        weeklyChart.options.scales.y.ticks.stepSize = 10;
                        weeklyChart.update();
                    }
                }, 500);

                // templatePie 차트는 loadTemplateStats()에서 동적으로 생성됨
                // mobilityPie 차트는 loadTransportationStats()에서 동적으로 생성됨

                const travelTimeEl = document.getElementById('travelTimeLine');

                if (travelTimeEl) {
                    const travelData = [48, 45, 43, 44, 41, 39];
                    const travelChart = new Chart(travelTimeEl, {
                        type: 'line',
                        data: {
                            labels: ['5일 전', '4일 전', '3일 전', '2일 전', '어제', '오늘'],
                            datasets: [{
                                label: '평균 이동 시간',
                                data: travelData.map(() => 0),
                                borderColor: '#FF8126',
                                backgroundColor: 'rgba(255, 129, 38, 0.18)',
                                tension: 0.35,
                                fill: true,
                                pointRadius: 4,
                                pointBackgroundColor: '#FF8126',
                                pointHoverRadius: 5
                            }]
                        },
                        options: {
                            maintainAspectRatio: false,
                            scales: {
                                x: {
                                    ticks: {
                                        color: '#52606d'
                                    },
                                    grid: {
                                        color: 'rgba(82, 96, 109, 0.08)'
                                    }
                                },
                                y: {
                                    beginAtZero: false,
                                    ticks: {
                                        color: '#52606d',
                                        callback: (value) => `${value}분`
                                    },
                                    grid: {
                                        color: 'rgba(82, 96, 109, 0.12)'
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                },
                                tooltip: {
                                    callbacks: {
                                        label(context) {
                                            return `${context.parsed.y}분`;
                                        }
                                    }
                                }
                            }
                        }
                    });

                    setTimeout(() => {
                        travelChart.data.datasets[0].data = travelData;
                        travelChart.update();
                    }, 120);
                }

                // regionBar 차트는 loadPopularDistricts()에서 동적으로 생성됨

            </script>
        </div>
    </div>
</body>
</html>

