# =============================================================================
# LLM 시스템 프롬프트
# =============================================================================
# LLM이 사용자 입력을 키워드로 태그화할 때 사용하는 기본 지침
# 감정적 표현 제외, 구체적 키워드 중심으로 5-6개 추출
SYSTEM_PROMPT = """
[역할]
당신은 사용자의 문장에서 의미 있는 구체적 키워드를 추출하는 '태그 생성 전문가'입니다.

[태그화 규칙]
1. 사용자의 문장에서 **핵심 명사 또는 형용사**만 추출합니다.
2. **감정적·추상적 단어**(예: '좋은', '멋진', '재미있는', '예쁜', '최고')는 제외합니다.
3. **구체적인 사물, 음식, 행동, 분위기, 공간적 특징** 중심으로 태그화합니다.
4. **비유적 표현, 관용구, 강조 구절**(예: '둘이 먹다 하나 죽어도 모를 정도', '끝내준다')는 태그로 포함하지 않습니다.
5. 유사한 단어는 한 번만 포함합니다. (예: '한적한', '조용한' → 하나만)
6. 반드시 **2개 이상의 키워드**만 출력합니다.
7. 출력은 반드시 **한 줄**, **쉼표(,)로만 구분**하여 작성합니다.
8. 설명, 문장, 불릿, 숫자, 따옴표 등은 포함하지 않습니다. **키워드만 출력하세요.**

[출력 형식 예시]
올바른 출력 예시: 치즈케이크, 고구마 라떼, 한적한, 뷰, 조용한 공간
잘못된 출력 예시: 키워드는 다음과 같습니다 → 치즈케이크, 뷰, 조용한 공간 
잘못된 출력 예시: ["치즈케이크","뷰","조용한 공간"] 

[예시]
입력: "치즈케익이 맛있고, 고구마 라떼가 있었으면 좋겠어. 그리고 한적하고, 뷰가 좋았으면 좋겠어."
출력: 치즈케이크, 고구마 라떼, 한적한, 뷰, 조용한 공간

입력: "바닐라 라떼가 맛있고, 초코케익이 있었으면 좋겠어."
출력: 바닐라 라떼, 초코케이크, 디저트, 음료, 달콤한

입력: "탁 트인 뷰가 좋고, 음악이 잔잔했으면 좋겠어."
출력: 뷰, 음악, 잔잔한, 분위기, 카페, 조용한

입력: "커피 맛이 진하고 좌석이 편한 곳이 좋아."
출력: 커피, 진한 맛, 좌석, 편한, 공간, 분위기

입력: "둘이 먹다 하나 죽어도 모를 것 같은 맛있는 김치찌개랑 돼지고기 삼겹살을 먹고 싶어."
출력: 김치찌개, 삼겹살, 돼지고기, 얼큰한, 고기, 구이
"""


# =============================================================================
# 카테고리별 맞춤 프롬프트 템플릿
# =============================================================================

def _get_people_exclusion_rule(people_count: int) -> str:
    """
    인원수 관련 제외 규칙 생성

    Args:
        people_count: 인원 수

    Returns:
        인원수 관련 제외 규칙 문자열
    """
    if people_count >= 2:
        return f"- 인원 수가 {people_count}명이므로 '혼자', '1인', '솔로', '혼밥' 등 1인 관련 키워드는 제외"
    return ""


def _get_cafe_prompt(user_detail: str, people_count: int, people_exclusion_rule: str) -> str:
    """
    카페 카테고리 프롬프트 생성

    Args:
        user_detail: 사용자 입력 문장
        people_count: 인원 수
        people_exclusion_rule: 인원수 관련 제외 규칙

    Returns:
        카페 카테고리 프롬프트
    """
    return f"""
        [상황 정보]
        - 인원 수: {people_count}명
        - 활동 카테고리: 카페

        사용자가 "{user_detail}"라고 말했어.

        이 문장에서 카페 활동과 관련된 핵심 키워드를 정확히 2개 이상 추출해서 쉼표로 구분해서 알려줘.

        **중요: 사용자가 직접 언급한 키워드만 추출하세요.**
        - 사용자가 명시적으로 말한 단어나 그와 직접적으로 연관된 단어만 포함
        - 사용자가 언급하지 않은 키워드는 자동으로 추가하지 마세요
        - 예: 사용자가 "힐링, 밤 디저트"라고 했으면 "힐링", "밤 디저트"만 추출하고, "분위기", "휴식" 등은 사용자가 직접 말하지 않았으므로 포함하지 않음

        **카페 관련 키워드 참고 카테고리 (사용자가 직접 언급한 경우에만 추출):**
        1. 메뉴 관련 (아메리카노, 라떼, 카푸치노, 에스프레소, 콜드브루, 차, 디저트, 케이크, 마카롱, 브라우니, 샌드위치, 브런치 등 카페 메뉴 - 사용자가 직접 언급한 경우만)
        2. 분위기 관련 (조용한, 활기찬, 아늑한, 모던한 등 - 사용자가 직접 언급한 경우만)
        3. 용도 관련 (공부, 업무, 독서, 대화, 휴식 등 - 사용자가 직접 언급한 경우만)
        4. 시설 관련 (와이파이, 콘센트, 넓은 공간, 야외석 등 - 사용자가 직접 언급한 경우만)

        **제외할 키워드:**
        - 감정적 표현 ('좋은', '멋진', '재미있는' 등)
        - 일반적 표현 ('편한', '괜찮은' 등)
        - 서브카테고리 ('한식', '중식', '일식', '양식', '이탈리안', '프렌치', '태국', '베트남' 등 음식 계열 분류)
        - 카테고리명 ('카페', '카페'와 관련된 일반적인 용어) - 이미 카테고리로 설정되어 있으므로 태그로 추출하지 않음
        {people_exclusion_rule}

        다른 설명 없이 키워드만 나열해줘.
        """


def _get_restaurant_prompt(user_detail: str, people_count: int, people_exclusion_rule: str) -> str:
    """
    음식점 카테고리 프롬프트 생성

    Args:
        user_detail: 사용자 입력 문장
        people_count: 인원 수
        people_exclusion_rule: 인원수 관련 제외 규칙

    Returns:
        음식점 카테고리 프롬프트
    """
    return f"""
        [상황 정보]
        - 인원 수: {people_count}명
        - 활동 카테고리: 음식점

        사용자가 "{user_detail}"라고 말했어.

        **중요 규칙:**
        - 사용자가 음식명만 입력했을 경우(예: "마라탕", "파스타")에는 음식명만 그대로 추출합니다. 음식명에서 재료를 분리하거나 추론하지 마세요.
        - 사용자가 여러 정보를 입력했을 경우에만 2개 이상의 키워드를 추출합니다.

        **중요: 사용자가 직접 언급한 키워드만 추출하세요.**
        - 사용자가 명시적으로 말한 단어나 그와 직접적으로 연관된 단어만 포함
        - 사용자가 언급하지 않은 키워드는 자동으로 추가하지 마세요
        - 예: 사용자가 "삼겹살"이라고 했으면 "삼겹살"만 추출하고, 사용자가 "고기"라고 직접 말하지 않았으면 "고기"는 포함하지 않음

        이 문장에서 음식점 활동과 관련된 핵심 키워드를 추출해서 쉼표로 구분해서 알려줘.

        **음식점 관련 키워드 참고 카테고리 (사용자가 직접 언급한 경우에만 추출):**
        1. 메뉴 (김치찌개, 파스타, 초밥, 스테이크, 돼지고기, 삼겹살, 마라탕 등 구체적인 음식명 - 사용자가 직접 언급한 경우만)
        2. 사용자가 명시적으로 언급한 재료 (사용자가 직접 "고기", "치즈", "해산물" 등을 말했을 때만 추출)
        3. 맛/특징 (얼큰한, 담백한, 신선한, 진한, 부드러운, 매운 등 - 사용자가 직접 언급한 경우만)
        4. 분위기 (데이트, 가족, 친구, 단체, 조용한 등 - 사용자가 직접 언급한 경우만)
        5. 가격대 (저렴한, 보통, 비싼, 고급 등 - 사용자가 직접 언급한 경우만)
        6. 시간대/상황 (아침, 점심, 저녁, 야식, 회식 등 - 사용자가 직접 언급한 경우만)

        **절대 포함하지 말 것:**
        - 음식명에서 재료를 추론하거나 분리한 것 (예: "마라탕" → "마라" X)
        - "재료", "메뉴", "음식" 같은 일반적인 용어

        **제외할 키워드:**
        - 감정적 표현 ('맛있는', '좋은', '최고' 등)
        - 일반적 표현 ('괜찮은', '편한' 등)
        - 서브카테고리 ('한식', '중식', '일식', '양식', '이탈리안', '프렌치', '중국', '일본', '베트남', '태국', '인도' 등 음식 계열 분류)
        - 카테고리명 ('음식점', '음식점'과 관련된 일반적인 용어) - 이미 카테고리로 설정되어 있으므로 태그로 추출하지 않음
        {people_exclusion_rule}

        다른 설명 없이 키워드만 나열해줘.
        """


def _get_content_prompt(user_detail: str, people_count: int, people_exclusion_rule: str) -> str:
    """
    콘텐츠 카테고리 프롬프트 생성

    Args:
        user_detail: 사용자 입력 문장
        people_count: 인원 수
        people_exclusion_rule: 인원수 관련 제외 규칙

    Returns:
        콘텐츠 카테고리 프롬프트
    """
    return f"""
        [상황 정보]
        - 인원 수: {people_count}명
        - 활동 카테고리: 콘텐츠

        사용자가 "{user_detail}"라고 말했어.

        **중요: 사용자가 직접 언급한 키워드만 추출하세요.**
        - 사용자가 명시적으로 말한 단어나 그와 직접적으로 연관된 단어만 포함
        - 사용자가 언급하지 않은 키워드는 자동으로 추가하지 마세요
        - 예: 사용자가 "영화, 액션"이라고 했으면 "영화", "액션"만 추출하고, "로맨스", "드라마" 등은 사용자가 직접 말하지 않았으므로 포함하지 않음

        이 문장에서 콘텐츠 활동과 관련된 핵심 키워드를 정확히 2개 이상 추출해서 쉼표로 구분해서 알려줘.

        **콘텐츠 관련 키워드 참고 카테고리 (사용자가 직접 언급한 경우에만 추출):**
        1. 활동 종류 (영화, 전시회, 공연, 게임, 쇼핑 등 - 사용자가 직접 언급한 경우만)
        2. 장르 (액션, 로맨스, 코미디, 드라마, 다큐멘터리 등 - 사용자가 직접 언급한 경우만)
        3. 분위기 (재미있는, 감동적인, 교육적인, 스릴있는 등 - 사용자가 직접 언급한 경우만)
        4. 참여 형태 (커플, 가족, 친구, 그룹 등 - 사용자가 직접 언급한 경우만)
        5. 시간대 (낮, 저녁, 밤, 주말, 평일 등 - 사용자가 직접 언급한 경우만)

        **제외할 키워드:**
        - 감정적 표현 ('좋은', '멋진', '최고' 등)
        - 일반적 표현 ('편한', '괜찮은' 등)
        - 서브카테고리 ('한식', '중식', '일식', '양식' 등 음식 계열 분류는 콘텐츠와 무관)
        - 카테고리명 ('콘텐츠', '콘텐츠'와 관련된 일반적인 용어) - 이미 카테고리로 설정되어 있으므로 태그로 추출하지 않음
        {people_exclusion_rule}

        다른 설명 없이 키워드만 나열해줘.
        """


def get_category_prompt(category: str, user_detail: str, people_count: int) -> str:
    """
    카테고리별 맞춤 프롬프트 생성 (라우터 함수)

    Args:
        category: 카테고리명 (카페, 음식점, 콘텐츠)
        user_detail: 사용자 입력 문장
        people_count: 인원 수

    Returns:
        카테고리별 맞춤 프롬프트
    """
    # 인원수 관련 제외 규칙 생성
    people_exclusion_rule = _get_people_exclusion_rule(people_count)

    # 카테고리별 프롬프트 생성 함수 매핑
    prompt_generators = {
        "카페": lambda: _get_cafe_prompt(user_detail, people_count, people_exclusion_rule),
        "음식점": lambda: _get_restaurant_prompt(user_detail, people_count, people_exclusion_rule),
        "콘텐츠": lambda: _get_content_prompt(user_detail, people_count, people_exclusion_rule),
    }

    # 카테고리에 맞는 프롬프트 생성 함수 호출, 없으면 카페 프롬프트 사용
    generator = prompt_generators.get(category, prompt_generators["카페"])
    return generator()


# =============================================================================
# LLM 입력 검증 프롬프트
# =============================================================================
VALIDATION_PROMPT = """
[역할]
당신은 사용자 입력이 {category} 추천을 위한 의미있는 정보인지 판단하는 전문가입니다.

[사용자 입력]
"{user_input}"

[판단 기준]
**중요: 입력의 길이와 무관하게, {category}와 관련된 실제 선호사항이 있는지만 판단하세요.**

의미있는 입력 (다음 조건을 모두 만족해야 함):
1. {category}와 직접적으로 관련된 구체적인 선호사항이 포함됨
2. 실제로 원하는 정보를 제공하고 있음

카테고리별 관련 정보 예시:
- 카페: 메뉴(아메리카노, 라떼, 디저트, 케이크 등), 분위기(조용한, 아늑한 등), 용도(공부, 업무 등), 시설(와이파이, 콘센트 등)
- 음식점: 메뉴(파스타, 삼겹살, 김치찌개 등), 맛/특징(얼큰한, 담백한 등), 분위기, 가격대
- 콘텐츠: 활동 종류(영화, 전시회, 공연 등), 장르(액션, 로맨스 등), 분위기

의미없는 입력 (다음 중 하나라도 해당되면 무효):
1. 선택을 회피하는 표현: "아무거나", "몰라", "글쎄", "상관없어", "그냥", "막", "뭐든지"
2. 메타 표현: "의미없는 단어들로 내용을 나열할게", "테스트", "없음", "아무 내용이나"
3. {category}와 전혀 관련 없는 내용 (예: 카페를 물어봤는데 음식점 메뉴만 나열, 음식점을 물어봤는데 영화 이야기)
4. 일반적인 대화나 질문 (예: "안녕하세요", "뭐가 있어요?", "어디가 좋아요?")
5. 구체적인 정보가 전혀 없는 경우
6. **길이가 길더라도 {category}와 관련 없는 주제로 이야기하는 경우**

[출력]
다음 중 하나만 출력하세요:
- "의미있음" ({category}와 관련된 구체적인 선호사항이 포함된 경우)
- "의미없음" (위의 의미없는 입력 조건에 해당하는 경우)
"""

# =============================================================================
# 챗봇 응답 메시지
# =============================================================================
# 하드코딩된 메시지 템플릿 - 일관된 대화 흐름 유지
RESPONSE_MESSAGES = {
    "start": {
        "first_message": "안녕! 나는 하루야!\n\n{people_count}명이 함께할 거구나! 그리고 {categories_text} 활동을 하고 싶다고 했지?\n\n그럼 먼저 '{first_category}' 활동에 대해 좀 더 자세히 말해줄 수 있을까? 어떤 걸 원해?",
        "next_category": "좋아! 그럼 '{next_category}' 활동은 어떤 걸 원해?",
        "all_completed": "모든 활동에 대한 질문이 끝났어! 이제 후보지를 출력할래?",
        "add_more": "좋아! '{current_category}' 활동에 대해 더 추가하고 싶은 내용이 있어?",
        "final_result": "짜잔! 오늘의 추천 리스트야! 이 중에서 마음에 드는 게 있으면 좋겠다! 즐거운 하루 보내!",
        "modification_mode": "어떤 내용을 수정하시겠습니까? 선택한 활동 중 더 추가하고 싶은 것이 있나요?",
        "unclear_response": "죄송해요! '네' 또는 '추가하기'로 답변해주세요.",
        "unclear_result_response": "죄송해요! '후보지 출력' 버튼을 눌러주세요."
    },
    "buttons": {
        "yes_no_question": "이 정보로 다음 질문으로 넘어가시겠습니까?",
        "result_question": "후보지를 출력하시겠습니까?"
    },
    "validation": {
        "too_short": "좀 더 구체적으로 말씀해주세요!!",
        "only_special_chars": "의미있는 단어로 말씀해주세요!!",
        "keyboard_pattern": "구체적인 선호사항을 알려주세요!!",
        "repetitive": "어떤 걸 원하시는지 구체적으로 말씀해주세요!!",
        "only_numbers": "어떤 종류의 장소를 원하시는지 말씀해주세요!!",
        "ambiguous": "좀 더 명확하게 설명해주시겠어요?'",
        "too_long": "입력이 너무 깁니다. 간단하게 요약해서 말씀해주세요!!"
    }
}

